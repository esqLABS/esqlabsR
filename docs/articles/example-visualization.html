<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="esqlabsR">
<title>Visualization and reporting • esqlabsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualization and reporting">
<meta property="og:description" content="esqlabsR">
<meta property="og:image" content="https://esqlabs.github.io/esqlabsR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">esqlabsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-handling.html">Data handling</a>
    <a class="dropdown-item" href="../articles/example-visualization.html">Visualization and reporting</a>
    <a class="dropdown-item" href="../articles/example-workflow.html">Running simulations</a>
    <a class="dropdown-item" href="../articles/introduction-esqlabsr.html">Introduction to esqlabsR</a>
    <a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity analysis</a>
    <a class="dropdown-item" href="../articles/shiny-apps.html">Using the esqlabsR Shiny apps</a>
    <a class="dropdown-item" href="../articles/standard-workflow.html">Standard workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/esqLABS/esqlabsR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visualization and reporting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/esqLABS/esqlabsR/blob/HEAD/vignettes/example-visualization.Rmd" class="external-link"><code>vignettes/example-visualization.Rmd</code></a></small>
      <div class="d-none name"><code>example-visualization.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h3>
<p>Plotting the simulation results is an important part of model
diagnostics and quality control. Simulated modeling scenarios can be
passed to plotting functions from the <a href="https://github.com/open-systems-pharmacology/ospsuite-r" class="external-link">ospsuite</a> package to
create uniformly-looking plots.</p>
<p><code>DataCombined</code> is a class used to store matching observed
and simulated data. Initialize a new class instance and populate it with
data with the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataCombined</span> <span class="op">&lt;-</span> <span class="va">DataCombined</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dataCombined</span><span class="op">$</span><span class="fu">addDataSets</span><span class="op">(</span><span class="va">observedData</span>, names <span class="op">=</span> <span class="st">"Observed"</span>, groups <span class="op">=</span> <span class="st">"Aciclovir"</span><span class="op">)</span></span>
<span><span class="va">dataCombined</span><span class="op">$</span><span class="fu">addSimulationResults</span><span class="op">(</span><span class="va">simulatedScenarios</span><span class="op">$</span><span class="va">TestScenario</span><span class="op">$</span><span class="va">results</span>, names <span class="op">=</span> <span class="st">"Simulated"</span>, groups <span class="op">=</span> <span class="st">"Aciclovir"</span><span class="op">)</span></span>
<span><span class="va">dataCombined</span><span class="op">$</span><span class="fu">toDataFrame</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,452 × 25</span></span></span>
<span><span class="co">#&gt;    name     group    dataT…¹ xValues xUnit xDime…² yValues yUnit yDime…³ yErro…⁴</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Observed Aciclov… observ…   0.273 h     Time      2.37  mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Observed Aciclov… observ…   0.485 h     Time      2.95  mg/l  Concen…    1.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Observed Aciclov… observ…   0.758 h     Time      3.08  mg/l  Concen…    1.28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Observed Aciclov… observ…   1.15  h     Time      3.08  mg/l  Concen…    1.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Observed Aciclov… observ…   1.61  h     Time      2.17  mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Observed Aciclov… observ…   1.97  h     Time      1.93  mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Observed Aciclov… observ…   3     h     Time      1.31  mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Observed Aciclov… observ…   5.03  h     Time      0.732 mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Observed Aciclov… observ…   7     h     Time      0.434 mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Observed Aciclov… observ…  11.0   h     Time      0.164 mg/l  Concen…    0   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1,442 more rows, 15 more variables: yErrorType &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   yErrorUnit &lt;chr&gt;, molWeight &lt;dbl&gt;, lloq &lt;dbl&gt;, Sheet &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Study Id` &lt;chr&gt;, `Subject Id` &lt;chr&gt;, Organ &lt;chr&gt;, Compartment &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Species &lt;chr&gt;, Gender &lt;chr&gt;, Dose &lt;chr&gt;, Molecule &lt;chr&gt;, Route &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   IndividualId &lt;int&gt;, and abbreviated variable names ¹​dataType, ²​xDimension,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​yDimension, ⁴​yErrorValues</span></span></span></code></pre></div>
<p>The simulation results are stored in a list returned by the
<code><a href="../reference/runScenarios.html">runScenarios()</a></code> function. Plotting and visualization is
performed by storing these results along with matching observed data in
a <code>DataCombined</code> object and passing it to plotting functions.
Observed data in the form of <code>Data Set</code> objects is added to a
<code>DataCombined</code> object via the <code>addDataSets</code>
method, simulated data can be added by using
<code>addSimulationResults</code>. Observed and simulated data can be
linked by setting the <code>groups</code> argument in both methods. Data
of the same group will then be plotted together when calling plotting
functions on the <code>DataCombined</code> object.</p>
<p>Plotting functions in the <a href="https://github.com/open-systems-pharmacology/ospsuite-r" class="external-link">ospsuite</a> package are
wrappers around <a href="https://github.com/open-systems-pharmacology/tlf-library" class="external-link">tlf</a> plotting functions that provide
default plot configuration options. All of them accept instances of
<code>DataCombined</code> class as the data source.</p>
<p>Time profile plots visualize the pharmacokinetics of the drug in
question and help assess if the observed data (represented by points and
error bars) match the simulated data (represented by lines).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotIndividualTimeProfile</span><span class="op">(</span><span class="va">dataCombined</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_segment).</span></span>
<span><span class="co">#&gt; Removed 8 rows containing missing values (geom_segment).</span></span></code></pre></div>
<p><img src="example-visualization_files/figure-html/plot-time-profile-1.png" width="672"></p>
<p>Observed versus simulated plots show if simulated time points and
observed time points follow a linear trend.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotObservedVsSimulated</span><span class="op">(</span><span class="va">dataCombined</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-visualization_files/figure-html/plot-obs-vs-pred-1.png" width="672"></p>
<p>Residual plots show if there is a systematic bias in how the
simulation represents values either in high-concentration or
low-concentration regions, or, alternatively, in early or late time
periods.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotResidualsVsSimulated</span><span class="op">(</span><span class="va">dataCombined</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-visualization_files/figure-html/residuals-vs-simulated-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotResidualsVsTime</span><span class="op">(</span><span class="va">dataCombined</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-visualization_files/figure-html/residuals-vs-time-1.png" width="672"></p>
<p>The plots returned by plotting functions are <code>ggplot</code>
objects. They can be modified further and saved to files with
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotObject</span> <span class="op">&lt;-</span> <span class="fu">plotIndividualTimeProfile</span><span class="op">(</span><span class="va">dataCombined</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"../Results/aciclovir_time_profile.png"</span>, <span class="va">plotObject</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values (geom_segment).</span></span>
<span><span class="co">#&gt; Removed 8 rows containing missing values (geom_segment).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<ul>
<li>At any time, you can check the groups assigned to the datasets in
the <code>DataCombined</code> object by examining the output of
<code>dataCombined$toDataFrame()</code>.</li>
</ul>
<p>More detailed information on function signatures can be found in:</p>
<ul>
<li>
<code>ospsuite</code> documentation on:
<ul>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/Simulation.html" class="external-link">Simulation
class</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/SimulationResults.html" class="external-link">SimulationResults
class</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/DataCombined.html" class="external-link">DataCombined
class</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/plotIndividualTimeProfile.html" class="external-link">plotIndividualTimeProfile()</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/plotObservedVsSimulated.html" class="external-link">plotObservedVsSimulated()</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/plotResidualsVsSimulated.html" class="external-link">plotResidualsVsSimulated()</a></li>
<li><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/plotResidualsVsTime.html" class="external-link">plotResidualsVsTime()</a></li>
</ul>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://esqlabs.com/" class="external-link"><img src="https://esqlabs.github.io/esqlabsR/reference/figures/esqlabs.png" height="24"></a>, Pavel Balazki, Johanna Eitel, Sergei Vavilov, <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
