# esqlabsR

The [esqlabsR](https://github.com/esqLABS/esqlabsR) package facilitates
and standardizes the modeling and simulation of physiologically based
kinetic (PBK) and quantitative systems pharmacology/toxicology (QSP/T)
models implemented in the [Open Systems Pharmacology
Software](https://www.open-systems-pharmacology.org/) (OSPS).

The [esqlabsR](https://github.com/esqLABS/esqlabsR) package is designed
for PBK modelers who use the OSPS suite. By using this package, you can
streamline your modeling and simulation (M&S) workflow and ensure
standardized and reproducible practices.

The package provides functions to:

- Design, import and run Simulations,
- Generate standardized plots and other reporting materials,
- Interact with the OSPS features using simple Excel files.

To get started with the esqlabsR package, please follow the [Get Started
tutorial](https://esqlabs.github.io/esqlabsR/articles/esqlabsR.html).

## Installation

### Pre-requisites

- [For
  Windows](https://github.com/Open-Systems-Pharmacology/rSharp?tab=readme-ov-file#prerequisites)
- [For
  Linux](https://github.com/Open-Systems-Pharmacology/rSharp?tab=readme-ov-file#ubuntu)

### Install the package

You can install the package by running:

``` r
install.packages("pak")
pak::pak("esqLABS/esqlabsR@*release")
```

The latest development version of the package can also be installed
with:

``` r
pak::pak("esqLABS/esqlabsR")
```

Note: For projects created for version 3 of `esqlabsR` package, refer to
[`esqlabsRLegacy`](https://github.com/esqLABS/esqlabsRLegacy).

## Usage

You can start with the “Get Started” vignette:
[`vignette("esqlabsR")`](https://esqlabs.github.io/esqlabsR/articles/esqlabsR.md).

[esqlabsR](https://github.com/esqLABS/esqlabsR) workflows require a
specific project structure. You can initialize a new project by running:

``` r
esqlabsR::initProject()
```

This will create the required folder structure and files for your
project in the working directory from where you run the command.

Below is a simple example of how to work with the package:

``` r
# load esqlabsR
library(esqlabsR)

# Load excel-based configuration
# The function `exampleProjectConfigurationPath()` returns the path to the example project
# configuration included in the package. Replace the variable `configurationPath`
# with the path to you project configuration file.
configurationPath <- exampleProjectConfigurationPath()

myProjectConfiguration <-
  createProjectConfiguration(configurationPath)

# Define which scenarios to run
scenarioNames <- c("TestScenario")
# Set scenario names to NULL if you want to simulate all scenarios defined in the
# excel file
# scenarioNames <- NULL

# Create `ScenarioConfiguration` objects from excel files
scenarioConfigurations <- readScenarioConfigurationFromExcel(
  scenarioNames = scenarioNames,
  projectConfiguration = myProjectConfiguration
)

# Define custom parameters for the scenarios. These parameter will be applied
# additionally to the paremetrization specified in the Excel files.
customParam <- list(
  paths = c(
    "Aciclovir|Lipophilicity"
  ),
  values = c(
    -0.1
  ),
  units = c(
    "Log Units"
  )
)

# Create simulation scenarios defined in the excel files and apply the custom parameters
myScenarios <- createScenarios(
  scenarioConfigurations = scenarioConfigurations,
  customParams = customParam
)

# Adjust simulation run options, if necessary.
# E.g. disable check for negative values if required
simulationRunOptions <- ospsuite::SimulationRunOptions$new()
simulationRunOptions$checkForNegativeValues <- FALSE

# Run simulations
simulatedScenariosResults <- runScenarios(
  scenarios = myScenarios,
  simulationRunOptions = simulationRunOptions
)

    # Save results and store the path to the results for later re-use
    outputFolder <- saveScenarioResults(simulatedScenariosResults, myProjectConfiguration)

    # Load observed data using the default importer configuration provided with the package. Alternatively, you can load a custom data importer configuration.
  dataSheets <- c("Laskin 1982.Group A")
  observedData <- esqlabsR::loadObservedData(
    projectConfiguration = myProjectConfiguration,
    sheets = dataSheets
  )

  ########## Create figures defined in the Plots.xlsx file########
  plots <- createPlotsFromExcel(
    plotGridNames = c("Aciclovir",
                      "Aciclovir2"),
    simulatedScenarios = simulatedScenariosResults,
    observedData = observedData,
    projectConfiguration = myProjectConfiguration,
    outputFolder = outputFolder,
    stopIfNotFound = TRUE
  )

  plots$Aciclovir
```

![](reference/figures/README-unnamed-chunk-6-1.png)

## Learn More

You can find more information on specific topics in dedicated vignettes:

- Start with `vignette("esqlabsR-workflow-overview")` to learn about the
  esqlabsR’s streamlined workflow.
- `vignette("esqlabsR-project-structure")` details the structure and
  purpose of each component file and directory of an esqlabsR project.
- `vignette("esqlabsR-design-scenarios")` explains how you can design
  your own simulations only using excel files.
- `vignette("esqlabsR-run-simulations")` describes all you need to know
  to run your customized simulations.
- `vignette("esqlabsR-plot-results")` explains how to generate
  visualizations from simulations.

## Related Work

[esqlabsR](https://github.com/esqLABS/esqlabsR) relies on the following
Open Systems Pharmacology R packages:

- [rSharp](https://github.com/Open-Systems-Pharmacology/rSharp/)
- [ospsuite.utils](https://github.com/Open-Systems-Pharmacology/OSPSuite.RUtils)
- [tlf](https://github.com/Open-Systems-Pharmacology/TLF-Library)
- [ospsuite](https://github.com/Open-Systems-Pharmacology/OSPSuite-R)

## Contributing

- Follow the OSPS-R [coding
  standards](https://dev.open-systems-pharmacology.org/r-development-resources/coding_standards_r).
- Our contribution guide can be found
  [here](https://dev.open-systems-pharmacology.org/r-development-resources/collaboration_guide).

## Code of Conduct

Please note that the esqlabsR project is released with a [Contributor
Code of
Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.

# Package index

## Project workflow

- [`ProjectConfiguration`](https://esqlabs.github.io/esqlabsR/reference/ProjectConfiguration.md)
  : ProjectConfiguration

- [`createDefaultProjectConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/createDefaultProjectConfiguration.md)
  :

  Create a default `ProjectConfiguration`

- [`createProjectConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/createProjectConfiguration.md)
  :

  Create a `ProjectConfiguration`

- [`exampleProjectConfigurationPath()`](https://esqlabs.github.io/esqlabsR/reference/exampleProjectConfigurationPath.md)
  : Get the path to example ProjectConfiguration.xlsx

- [`initProject()`](https://esqlabs.github.io/esqlabsR/reference/initProject.md)
  : Initialize esqlabsR Project Folders and required Files

- [`isProjectInitialized()`](https://esqlabs.github.io/esqlabsR/reference/isProjectInitialized.md)
  : Check if a directory contains an esqlabsR project

- [`restoreProjectConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/restoreProjectConfiguration.md)
  : Import project configuration from JSON to Excel files

- [`snapshotProjectConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/snapshotProjectConfiguration.md)
  : Export project configuration Excel files to JSON

- [`Scenario`](https://esqlabs.github.io/esqlabsR/reference/Scenario.md)
  : Scenario

- [`ScenarioConfiguration`](https://esqlabs.github.io/esqlabsR/reference/ScenarioConfiguration.md)
  : ScenarioConfiguration

- [`addScenarioConfigurationsToExcel()`](https://esqlabs.github.io/esqlabsR/reference/addScenarioConfigurationsToExcel.md)
  : Add scenario configurations to project Excel files

- [`createScenarioConfigurationsFromPKML()`](https://esqlabs.github.io/esqlabsR/reference/createScenarioConfigurationsFromPKML.md)
  : Create scenario configurations from PKML files

- [`createScenarios()`](https://esqlabs.github.io/esqlabsR/reference/createScenarios.md)
  :

  Create `Scenario` objects from `ScenarioConfiguration` objects

- [`loadScenarioResults()`](https://esqlabs.github.io/esqlabsR/reference/loadScenarioResults.md)
  : Load simulated scenarios from csv and pkml.

- [`readScenarioConfigurationFromExcel()`](https://esqlabs.github.io/esqlabsR/reference/readScenarioConfigurationFromExcel.md)
  : Read scenario definition(s) from Excel file

- [`runScenarios()`](https://esqlabs.github.io/esqlabsR/reference/runScenarios.md)
  : Run a set of scenarios.

- [`saveScenarioResults()`](https://esqlabs.github.io/esqlabsR/reference/saveScenarioResults.md)
  : Save results of scenario simulations to csv.

- [`projectConfigurationStatus()`](https://esqlabs.github.io/esqlabsR/reference/projectConfigurationStatus.md)
  : Check if Excel configuration files are in sync with JSON snapshot

- [`createPlotsFromExcel()`](https://esqlabs.github.io/esqlabsR/reference/createPlotsFromExcel.md)
  :

  Generate plots as defined in excel file
  `projectConfiguration$plotsFile`

## Helpers for data import, wrangling, and export

- [`readExcel()`](https://esqlabs.github.io/esqlabsR/reference/readExcel.md)
  :

  Read XLSX files using
  [`readxl::read_excel`](https://readxl.tidyverse.org/reference/read_excel.html)
  with suppressed warnings

- [`readIndividualCharacteristicsFromXLS()`](https://esqlabs.github.io/esqlabsR/reference/readIndividualCharacteristicsFromXLS.md)
  : Read individual characteristics from file

- [`readParametersFromXLS()`](https://esqlabs.github.io/esqlabsR/reference/readParametersFromXLS.md)
  : Read parameter values from a structured Excel file. Each excel sheet
  must consist of columns 'Container Path', 'Parameter Name', 'Value',
  and 'Units'

- [`readPopulationCharacteristicsFromXLS()`](https://esqlabs.github.io/esqlabsR/reference/readPopulationCharacteristicsFromXLS.md)
  :

  Read an excel file containing information about population and create
  a `PopulationCharacteristics` object

- [`readScenarioConfigurationFromExcel()`](https://esqlabs.github.io/esqlabsR/reference/readScenarioConfigurationFromExcel.md)
  : Read scenario definition(s) from Excel file

- [`extendParameterStructure()`](https://esqlabs.github.io/esqlabsR/reference/extendParameterStructure.md)
  : Extend parameters structure with new entries

- [`extendPopulationByUserDefinedParams()`](https://esqlabs.github.io/esqlabsR/reference/extendPopulationByUserDefinedParams.md)
  : Add user defined variability on parameters to a population.

- [`extendPopulationFromXLS()`](https://esqlabs.github.io/esqlabsR/reference/extendPopulationFromXLS.md)
  : Add user defined variability on parameters to a population from an
  excel file.

- [`setApplications()`](https://esqlabs.github.io/esqlabsR/reference/setApplications.md)
  :

  Set an application protocol in a `Simulation` from the Excel file

- [`setParameterValuesByPathWithCondition()`](https://esqlabs.github.io/esqlabsR/reference/setParameterValuesByPathWithCondition.md)
  :

  Set the values of parameters in the simulation by path, if the
  `condition` is true.

- [`writeIndividualToXLS()`](https://esqlabs.github.io/esqlabsR/reference/writeIndividualToXLS.md)
  : Create a parameter set describing an individual and write it to the
  Excel file

- [`writeParameterStructureToXLS()`](https://esqlabs.github.io/esqlabsR/reference/writeParameterStructureToXLS.md)
  : Write parameter structure to excel that can be loaded in MoBi

- [`exportParametersToXLS()`](https://esqlabs.github.io/esqlabsR/reference/exportParametersToXLS.md)
  : Export simulation parameters to excel

- [`createDataCombinedFromExcel()`](https://esqlabs.github.io/esqlabsR/reference/createDataCombinedFromExcel.md)
  : Generate DataCombined objects as defined in excel file

## Helpers for modeling and simulation

- [`compareSimulations()`](https://esqlabs.github.io/esqlabsR/reference/compareSimulations.md)
  : Compare two simulations

- [`compareWithNA()`](https://esqlabs.github.io/esqlabsR/reference/compareWithNA.md)
  :

  Compare values including `NA`

- [`calculateMeanDataSet()`](https://esqlabs.github.io/esqlabsR/reference/calculateMeanDataSet.md)
  :

  Calculate mean and standard deviation for the yValues of the given
  `DataSet` objects

- [`initializeSimulation()`](https://esqlabs.github.io/esqlabsR/reference/initializeSimulation.md)
  : Load a simulation and apply a set of parameters.

- [`geomean()`](https://esqlabs.github.io/esqlabsR/reference/geomean.md)
  : Calculate geometric mean of a numeric vector

- [`geosd()`](https://esqlabs.github.io/esqlabsR/reference/geosd.md) :
  Calculate geometric standard deviation of a numeric vector

- [`sampleRandomValue()`](https://esqlabs.github.io/esqlabsR/reference/sampleRandomValue.md)
  : Sample a random value from a distribution

- [`applyIndividualParameters()`](https://esqlabs.github.io/esqlabsR/reference/applyIndividualParameters.md)
  :

  Apply an individual to the simulation. For human species, only
  parameters that do not override formulas are applied. For other
  species, all parameters returned by `createIndividual` are applied.

- [`Distributions`](https://esqlabs.github.io/esqlabsR/reference/Distributions.md)
  : Supported distributions for sampling

- [`LLOQMode`](https://esqlabs.github.io/esqlabsR/reference/LLOQMode.md)
  :

  Possible entries for the `lloqMode` argument of `calculateMeans()`

- [`ULOQMode`](https://esqlabs.github.io/esqlabsR/reference/ULOQMode.md)
  : Possible modes to treat values above the upper limit of
  quantification.

- [`loadObservedData()`](https://esqlabs.github.io/esqlabsR/reference/loadObservedData.md)
  : Load data from excel

- [`loadObservedDataFromPKML()`](https://esqlabs.github.io/esqlabsR/reference/loadObservedDataFromPKML.md)
  : Load data from pkml

## Helpers for plotting

- [`col2hsv()`](https://esqlabs.github.io/esqlabsR/reference/col2hsv.md)
  : Returns the HSV values for a given R color name

- [`esqlabsColors()`](https://esqlabs.github.io/esqlabsR/reference/esqlabsColors.md)
  : esqLABS color palette

- [`createEsqlabsExportConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/createEsqlabsExportConfiguration.md)
  :

  Create an instance of `ExportConfiguration` R6 class

- [`createEsqlabsPlotConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/createEsqlabsPlotConfiguration.md)
  :

  Create an instance of `DefaultPlotConfiguration` R6 class

- [`createEsqlabsPlotGridConfiguration()`](https://esqlabs.github.io/esqlabsR/reference/createEsqlabsPlotGridConfiguration.md)
  :

  Create an instance of `PlotGridConfiguration` R6 class

- [`createDataCombinedFromExcel()`](https://esqlabs.github.io/esqlabsR/reference/createDataCombinedFromExcel.md)
  : Generate DataCombined objects as defined in excel file

## Input validation

- [`validateAllConfigurations()`](https://esqlabs.github.io/esqlabsR/reference/validateAllConfigurations.md)
  : Validate all configuration files in a project
- [`validationResult`](https://esqlabs.github.io/esqlabsR/reference/validationResult.md)
  : validationResult
- [`validationSummary()`](https://esqlabs.github.io/esqlabsR/reference/validationSummary.md)
  : Get summary of all validation results
- [`isAnyCriticalErrors()`](https://esqlabs.github.io/esqlabsR/reference/isAnyCriticalErrors.md)
  : Check if validation results contain any critical errors
- [`isParametersEqual()`](https://esqlabs.github.io/esqlabsR/reference/isParametersEqual.md)
  : Check if two parameters are equal with respect to certain
  properties.
- [`isProjectInitialized()`](https://esqlabs.github.io/esqlabsR/reference/isProjectInitialized.md)
  : Check if a directory contains an esqlabsR project
- [`isTableFormulasEqual()`](https://esqlabs.github.io/esqlabsR/reference/isTableFormulasEqual.md)
  : Check if two table formulas are equal.
- [`stringToNum()`](https://esqlabs.github.io/esqlabsR/reference/stringToNum.md)
  : Convert string to numeric
- [`GenderInt`](https://esqlabs.github.io/esqlabsR/reference/GenderInt.md)
  : Possible gender entries as integer values

## Sensitivity analysis

- [`loadSensitivityCalculation()`](https://esqlabs.github.io/esqlabsR/reference/loadSensitivityCalculation.md)
  : Load Sensitivity Calculation Results
- [`saveSensitivityCalculation()`](https://esqlabs.github.io/esqlabsR/reference/saveSensitivityCalculation.md)
  : Save Sensitivity Calculation Results
- [`sensitivityCalculation()`](https://esqlabs.github.io/esqlabsR/reference/sensitivityCalculation.md)
  : Carry out and visualize sensitivity analysis (with OSPSuite)
- [`sensitivitySpiderPlot()`](https://esqlabs.github.io/esqlabsR/reference/sensitivitySpiderPlot.md)
  : Sensitivity Spider Plot for Pharmacokinetic Parameters
- [`sensitivityTimeProfiles()`](https://esqlabs.github.io/esqlabsR/reference/sensitivityTimeProfiles.md)
  : Time Profile plots for Sensitivity Analysis
- [`sensitivityTornadoPlot()`](https://esqlabs.github.io/esqlabsR/reference/sensitivityTornadoPlot.md)
  : Tornado Plot for Sensitivity Analysis

## Shiny applications

## Miscellaneous

- [`enumPutList()`](https://esqlabs.github.io/esqlabsR/reference/enumPutList.md)
  : Add a new key-value pairs to an enum, where the value is a list.

- [`getAllApplicationParameters()`](https://esqlabs.github.io/esqlabsR/reference/getAllApplicationParameters.md)
  : Get parameters of applications in the simulation

- [`getEsqlabsRSetting()`](https://esqlabs.github.io/esqlabsR/reference/getEsqlabsRSetting.md)
  : Get the value of a global esqlabsR setting.

- [`getIndexClosestToValue()`](https://esqlabs.github.io/esqlabsR/reference/getIndexClosestToValue.md)
  : Find value in an array

- [`getMoleculeNameFromQuantity()`](https://esqlabs.github.io/esqlabsR/reference/getMoleculeNameFromQuantity.md)
  : Get the name of the molecule from a quantity

- [`executeInParallel()`](https://esqlabs.github.io/esqlabsR/reference/executeInParallel.md)
  : Parallelize the execution of a function over a list of arguments
  values

- [`pathFromClipboard()`](https://esqlabs.github.io/esqlabsR/reference/pathFromClipboard.md)
  : Convert Windows filepaths for R

- [`removeFromList()`](https://esqlabs.github.io/esqlabsR/reference/removeFromList.md)
  : Remove an entry from a list

- [`sourceAll()`](https://esqlabs.github.io/esqlabsR/reference/sourceAll.md)
  : Source all .R files located in a specific folder

- [`esqlabsRSettingNames`](https://esqlabs.github.io/esqlabsR/reference/esqlabsRSettingNames.md)
  :

  Names of the settings stored in esqlabsEnv Can be used with
  [`getEsqlabsRSetting()`](https://esqlabs.github.io/esqlabsR/reference/getEsqlabsRSetting.md)

## Inherited classes

- [`ExportConfiguration`](https://esqlabs.github.io/esqlabsR/reference/ExportConfiguration.md)
  : ExportConfiguration

# Articles

### esqlabsR Workflow

- [Overview](https://esqlabs.github.io/esqlabsR/articles/workflow-overview.md):
- [Project
  configuration](https://esqlabs.github.io/esqlabsR/articles/project-structure.md):
- [2. Design
  Scenarios](https://esqlabs.github.io/esqlabsR/articles/design-scenarios.md):
- [3. Run
  Simulations](https://esqlabs.github.io/esqlabsR/articles/run-simulations.md):
- [4. Plot
  Results](https://esqlabs.github.io/esqlabsR/articles/plot-results.md):
- [Sensitivity
  Analysis](https://esqlabs.github.io/esqlabsR/articles/sensitivity.md):
- [Sensitivity Analysis – Plot
  Customization](https://esqlabs.github.io/esqlabsR/articles/sensitivity-plots.md):

### Miscellaneous

- [Slide
  Decks](https://esqlabs.github.io/esqlabsR/articles/presentations.md):
- [Advanced
  Topics](https://esqlabs.github.io/esqlabsR/articles/advanced.md):
- [Migrating Project Structure
  Versions](https://esqlabs.github.io/esqlabsR/articles/project-migration-guide.md):
