---
subtitle: '![](../../man/figures/logo.png){width=400}'
title: "Introduction to"
format:
  revealjs:
    mermaid:
      theme: neutral

date: 2025-01-02
#author: Felix MIL

self-contained: true
code-annotations: hover
code-line-numbers: false

execute:
  echo: true
---



# esqlabsR ?  {background-color="#0D8DDA" .white-text}

```{r, include=FALSE, message = FALSE, warning = FALSE}
require(emoji)
require(readxl)
require(reactable)
library(esqlabsR)
library(dplyr)
library(showtext)


showtext::showtext_opts(dpi = 300)

my_project_configuration <-
  createProjectConfiguration(path = exampleProjectConfigurationPath())
```

```{css, echo = FALSE}
.center {
text-align: center;
}

.white-text {
color: white;
}

.sourceCode.language-mermaid {
display: none;
}
```

## `{esqlabsR}` What ?
<br>

:::: {.columns}
::: {.column width="60%"}

<br>

-   R package
-   for PBK and QSP/T Modeling
-   Based on [Open Systems Pharmacology
Software](https://www.open-systems-pharmacology.org/)
:::

::: {.column .center width="40%"}
![](../../man/figures/logo.png){width="80%"}
:::
::::

::: footer
`{esqlabsR}` ?
:::

## `{esqlabsR}` Why ?
<br>

-   Simple functions to design, run and save simulations,
-   Interact with the {ospsuite} features using Excel files,
-   Generate standardized plots automatically.

<br>

::: {.center}
**`r emoji::emoji(keyword = "arrow_right")` Streamlined Simulation Workflow `r emoji::emoji(keyword = "rocket")`
**
:::

::: footer
`{esqlabsR}` ?
:::

## `{esqlabsR}` Where ?
<br>
<br>

- {{< fa brands github >}} Code repository: [github.com/esqLABS/esqlabsR](https://github.com/esqLABS/esqlabsR)

- {{< fa book >}} Documentation: [esqlabs.github.io/esqlabsR/](https://esqlabs.github.io/esqlabsR)

- {{< fa arrow-trend-up >}} [Get Started Tutorial](https://esqlabs.github.io/esqlabsR/articles/esqlabsR.html)


::: footer
`{esqlabsR}` ?
:::


## `{esqlabsR}` How ?
<br>

::: {.center}
```{r, eval=FALSE}
install.packages("pak")

pak::pak("esqLABS/esqlabsR*release")
```
<br>

**`r emoji::emoji("package")` Installation**
:::

## `{esqlabsR}` How ?
<br>

::: {.center}
![](../Figures/esqlabs-workflow.png)
<br>

**esqlabsR Workflow**
:::

::: footer
`{esqlabsR}` ?
:::


# Get Started {background-color="#26B042" .white-text}


# I. Project Configuration

## Project Structure
<br>

```{r, eval=FALSE, echo = TRUE}
library(esqlabsR)
initProject()
```

<br>

`initProject()` will create the expected simulation project's folder structure.

<br>

::: footer
I Project Configuration
:::

## Project Structure {auto-animate=true}
Each one of these folders contains a series of .xlsx files with specific purpose.

```{r, echo = FALSE, eval=FALSE}
# rerun this if project structure change and paste below
file_tree <- fs::dir_tree(esqlabsR:::exampleDirectory("TestProject"), glob = "*.md|*.R", invert = TRUE)
```

```{.sh}
my_project
├── ProjectConfiguration.xlsx
├── ProjectConfiguration.json
├── Configurations
│   ├── Applications.xlsx
│   ├── Individuals.xlsx
│   ├── ModelParameters.xlsx
│   ├── Plots.xlsx
│   ├── Populations.xlsx
│   ├── PopulationsCSV
│   │   └── TestPopulation.csv
│   └── Scenarios.xlsx
├── Data
├── Models
│   └── Simulations
│       └── Aciclovir.pkml
└── Results
    ├── Figures
    └── SimulationResults
```
::: footer
I Project Configuration
:::

## Project Structure {auto-animate=true}

Project's files are linked by the `ProjectConfiguration.xlsx` file.

```{.sh code-line-numbers="2"}
my_project
├── ProjectConfiguration.xlsx
├── ProjectConfiguration.json
├── Configurations
│   ├── Applications.xlsx
│   ├── Individuals.xlsx
│   ├── ModelParameters.xlsx
│   ├── Plots.xlsx
│   ├── Populations.xlsx
│   ├── PopulationsCSV
│   │   └── TestPopulation.csv
│   └── Scenarios.xlsx
├── Data
├── Models
│   └── Simulations
│       └── Aciclovir.pkml
└── Results
    ├── Figures
    └── SimulationResults
```

::: footer
I Project Configuration
:::

## Project Structure {auto-animate=true}

Everything is already configured !

```{r, echo = FALSE}
reactable::reactable(
  data = head(readxl::read_xlsx(path = exampleProjectConfigurationPath())),
  columns = list(
    "Property" = reactable::colDef(minWidth = 50),
    "Value" = reactable::colDef(minWidth = 50),
    "Description" = reactable::colDef(minWidth = 100)
  ),
  outlined = TRUE,
  pagination = FALSE,
  highlight = TRUE, style = list(fontSize = 20)
)
```

::: footer
I Project Configuration
:::

## ProjectConfiguration
<br>

:::{.center}
`createProjectConfiguration(path)`
:::

- targets `ProjectConfiguration.xlsx` file,
- creates a `ProjectConfiguration` object,
- Needed for all next steps !

<br>

```{r, eval = FALSE}
my_project_configuration <-
  createProjectConfiguration(path = "path/to/ProjectConfiguration.xlsx")
```

::: footer
I Project Configuration
:::

## ProjectConfiguration

```{r, eval = FALSE}
my_project_configuration
```

<br>

```
ProjectConfiguration:
Project Configuration File: TestProject/ProjectConfiguration.xlsx
Model folder: TestProject/Models/Simulations
Configurations folder: TestProject/Configurations
Model parameters file: TestProject/Configurations/ModelParameters.xlsx
Individuals file: TestProject/Configurations/Individuals.xlsx
...
```
::: footer
I Project Configuration
:::

## Version Control & Project Sharing {auto-animate=true}

<br>

**JSON Snapshots** for version control and team collaboration

<br>

```{r, eval = FALSE}
# Create snapshot
snapshotProjectConfiguration("ProjectConfiguration.xlsx")

# Restore from snapshot
restoreProjectConfiguration("ProjectConfiguration.json")
```

<br>

- Text-based format (Git-friendly)
- Easy team collaboration
- Reproducible project setup

::: footer
I Project Configuration
:::

# II. Design Scenarios

## Scenarios
<br>

Simulations are defined by **Scenarios**.

. . .

Scenarios are setup in the `Configurations/Scenarios.xlsx` file.

. . .


```{r, echo = FALSE}
scenarios <-
  readxl::read_xlsx(my_project_configuration$scenariosFile)

reactable::reactable(
  data = scenarios %>%
    select(
      Scenario_name,
      ModelFile,
      ModelParameterSheets,
      SimulationTime,
      IndividualId,
      PopulationId
    ),
  outlined = TRUE,
  pagination = FALSE,
  highlight = TRUE,
  style = list(fontSize = 20)
)
```

::: footer
II Design Scenarios
:::

## Scenarios parameterization

- Model
- Model parameters
- Application protocol
- Time range
- Individual characteristics
- Population
- ...

. . .

:::{.center}
**All in {{< fa file-excel >}} files !**
:::


::: footer
II Design Scenarios
:::

## Parameters files

```{mermaid}
%%| echo: false
flowchart TD
    Scenarios["`**Scenarios.xlsx**
    • ModelFile
    • ModelParametersSheets
    • ApplicationProtocol
    • IndividualId
    • PopulationId`"]

    Models["`**Models/**
    • Model1.pkml
    • Model2.pkml`"]

    ModelParams["`**ModelParameters.xlsx**
    ModelParametersSheets...
    • ContainerPath
    • Parameter Name
    • Value
    • Units`"]

    Applications["`**Applications.xlsx**
    ApplicationProtocol...
    • ContainerPath
    • Parameter Name
    • Value
    • Units`"]

    Individuals["`**Individuals.xlsx**
    IndividualBiometrics
    IndividualId...
    • ContainerPath
    • Parameter Name
    • Value
    • Units`"]

    Populations["`**Populations.xlsx**
    Demographics
    PopulationId...
    • ContainerPath
    • Parameter Name
    • Mean
    • SD
    • Distribution`"]

    Scenarios -->|ModelFile| Models
    Scenarios -->|ModelParametersSheets| ModelParams
    Scenarios -->|ApplicationProtocol| Applications
    Scenarios -->|IndividualId| Individuals
    Scenarios -->|PopulationId| Populations

    style Scenarios fill:#e1f5e1,stroke:#4caf50,stroke-width:3px
    style Models fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    style ModelParams fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
    style Applications fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
    style Individuals fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
    style Populations fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
```

::: footer
II Design Scenarios
:::

# III. Run Simulations

## Read Scenarios

```{r, cache = FALSE}
#| code-line-numbers: "3"
my_scenarios <- createScenarios(
  readScenarioConfigurationFromExcel(
    scenarioNames = "TestScenario",
    projectConfiguration = my_project_configuration
  )
)
```

::: footer
III Run Simulations
:::

## Scenarios Recap

```{r, eval = FALSE}
my_scenarios
```

```{r, echo = FALSE}
my_scenarios$TestScenario$scenarioConfiguration$print(projectConfiguration = FALSE)
```

::: footer
III Run Simulations
:::

## Run Simulations

```{r, cache = FALSE}
myScenarioResults <- runScenarios(my_scenarios)
```

<br>

```{r, echo = FALSE}
reactable::reactable(
  data = head(myScenarioResults$TestScenario$outputValues$data),
  columns = list(
    "IndividualId" = reactable::colDef(minWidth = 50),
    "Time" = reactable::colDef(minWidth = 50),
    "Organism|PeripheralVenousBlood|Aciclovir|Plasma (Peripheral Venous Blood)" = reactable::colDef(minWidth = 200)
  ),
  outlined = TRUE,
  pagination = FALSE,
  highlight = TRUE, style = list(fontSize = 20)
)
```


::: footer
III Run Simulations
:::


# IV. Plot Results

## {ospsuite} plotting functions

Simulation results are compatible with `{ospsuite}` plotting workflow.


```{r, cache = FALSE}
my_datacombined <- DataCombined$new()

my_datacombined$addSimulationResults(myScenarioResults$TestScenario$results,
  names = "Simulated",
  groups = "Aciclovir"
)
```

::: footer
IV Plot Results
:::

## {ospsuite} plotting functions

```{r, cache = TRUE, out.width="80%", fig.align="center", fig.width=5, fig.asp=0.618, dpi=300}
plotIndividualTimeProfile(my_datacombined)
```

::: footer
IV Plot Results
:::

## Create Plots from Excel

<br>

:::{.center}

Create plots (or plotgrids) from excel files using `createPlotsFromExcel()`.

<br>

```{r, eval = FALSE}
plots <- createPlotsFromExcel(
  projectConfiguration = my_project_configuration
)
```

<br>

**Available in esqlabsR v5.0.0+**

:::

::: footer
IV Plot Results
:::


##

<br>
<br>

::: {.center}
![](../Figures/esqlabs-workflow.png)
:::


## Help us improve esqlabsR  {background-color="#EB1733"}

<br>

:::{.center}
- Install & try,
- Add a `r emoji::emoji("star")` to the github repository,
- Leave comments/requests at:
  [github.com/esqLABS/esqlabsR/issues](https://github.com/esqLABS/esqlabsR/issues)
:::


# ![](../../man/figures/logo.png){width=400}

:::{.center}
**Thank You**
:::
