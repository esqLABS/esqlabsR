---
title: "1. Initialize a Project"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{esqlabs-project-structure}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(esqlabsR)
```


## Initialize the Project Structure

Project Structure can be initialized with `init_project`.

```{r, eval=FALSE, message = FALSE}
library(esqlabsR)

init_project(type = "demo") 
# or simply init_project() to create an empty folder structure and excel templates.
```

This will create a set of directories and files that match the expected project's 
structure.

```
my_project
├── ProjectConfiguration.xlsx
├── Data
├── Models
├── Parameters
│   ├── ApplicationParameters.xlsx
│   ├── Individuals.xlsx
│   ├── ModelParameters.xlsx
│   ├── Plots.xlsx
│   ├── PopulationParameters.xlsx
│   ├── Populations
│   │   └── PopulationScenario_population.csv
│   └── Scenarios.xlsx
└── Results
    ├── Figures
    └── SimulationResults

```
## Create a ProjectConfiguration

The ProjectConfiguration is crucial for esqlabsR project since it describes
the paths to the model, excel, data files and directories. It will be used
at several steps in the process so it needs to be created before performing
any simulations.

```{r, eval = FALSE}
my_project_configuration <- createDefaultProjectConfiguration(path = example_ProjectConfiguration())
```
```
ProjectConfiguration: 
Relative path from working directory: C:/[path]/TestProject
Project Configuration File: Code/ProjectConfiguration.xlsx 
Model folder: Models/Simulations 
Parameters folder: Parameters 
Parameters file name: Parameters/ModelParameters.xlsx 
Individual parameters file name: Parameters/Individuals.xlsx 
Population parameters file name: Parameters/PopulationParameters.xlsx
Scenario definitions file name: Parameters/Scenarios.xlsx
Scenario applications definitions file name: Parameters/ApplicationParameters.xlsx
Plot definitions file name: Parameters/Plots.xlsx
Experimental data folder: Data
Experimental data file: Data/TestProject_TimeValuesData.xlsx
Data importer configuration: Data/esqlabs_dataImporter_configuration.xml
Compound Properties File: Data/Compound Properties.xlsx
Output folder: Results
```

Now that the project structure is initialized and the `ProjectConfiguration` was 
created, read `vignette("esqlabsR-design-simulations")` to continue the process.
To learn more about ProjectConfiguration, read the following sections.

## Details

### Change ProjectConfiguration from R

If required, you can change the location of one of the files or folders using relative or absolute path

```{r, eval=FALSE}
# change the location of the output folder
projectConfiguration$outputFolder <- "../anotherOutputFolder"

# change the location of the model parameters file
projectConfiguration$modelParametersFile <- "absolute/path/to/anotherModelParameters.xlsx"
```


### About `ProjectConfiguration.xlsx`

The `ProjectConfiguration.xlsx` file will be used by `esqlabsR` to generate a
`ProjectConfiguration` object which is the central piece of a project.

This file defines *where* all the necessary files are stored in the project 
folder. All the path specified in the `Value` column should be *relative* to the
`ProjectConfiguration.xlsx` location.

All these directories and file have a specific purpose and template and are 
describe in next sections.

```{r, echo = FALSE}
#TODO Fix the "Description" text in excel file (not relative to Code folder anymore)
ProjectConfiguration_excel <- readxl::read_xlsx(example_ProjectConfiguration())

reactable::reactable(ProjectConfiguration_excel,
                     columns = list(
                       "Property" = reactable::colDef(minWidth = 50),
                       "Value" = reactable::colDef(show = FALSE),
                       "Description" = reactable::colDef(minWidth = 100)
                     ),
                     outlined = TRUE,
                     pagination = FALSE,
                     highlight = TRUE)
```


<!-- #### `Data/` -->
<!-- The `Data/` folder should contain all the Excel files with observed experimental  -->
<!-- data. -->

<!-- #### `Models/` -->
<!-- The `Models/` folder should contain all the `.pkml` files generated with the  -->
<!-- OSPS suite. -->

<!-- #### `Parameters/` -->
<!-- The `Parameters/` folder contains all the main Excel templates that serve as  -->
<!-- inputs to parameterize the simulations, plot outputs *etc.* -->

<!-- #### `Results/` -->
<!-- The `Results/` is where Figures and SimulationResults outputs generated by -->
<!-- `esqlabsR` will be written by default. -->

